<div class="collapse navbar-collapse">
  <ul class="nav navbar-nav navbar-right">
    <% if user_signed_in? %>
      <li>
        <div class="nav-noti-btn" style="height: 30px; width: 30px; padding: 2px 11px;
            <% if Noti.where(user_id: current_user.id, state: 0).present? %>
              background: #e3b323;<% else %>background: #a8a3a8;<% end %>margin: 11px;">
            <span style="font-size: 1.3em; color: white">
              <%= Noti.where(user_id: current_user.id, state: 0).count %>
            </span>
        </div>
      </li>
      <li><%= link_to t("nav.write_review"), new_review_path %></li>

      <li class="dropdown1">
        <a class="dropdown-toggle">
          <%= t "nav.account" %>
          <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><%= link_to t("nav.go_to_admin"), admin_path(current_user) %></li>
          <li><%= link_to t("nav.my_profile"), user_path(current_user) %></li>
          <li><%= link_to t("nav.setting"), edit_user_registration_path %></li>
          <li class="divider"></li>
          <li>
            <%= link_to t("nav.logout"), destroy_user_session_path, method: :delete %>
          </li>
        </ul>
      </li>
    <% else %>
      <li><%= link_to t("nav.login"), new_user_session_path %></li>
      <li id="signup"><%= link_to t("nav.signup"), new_user_registration_path %></li>
    <% end %>
    <li class="dropdown">
      <a class="dropdown-toggle">
        <%= t "nav.language" %>
        <span class="caret"></span></a>
      <ul class="dropdown-menu">
        <li><%= link_to "English", locale:"en" %></li>
        <li><%= link_to "Tiếng Việt", locale:"vn" %></li>
        <li><%= link_to "日本語", locale:"jp" %></li>
      </ul>
    </li>
  </ul>
  <% if current_user %>
    <div class="noti-field hide" style="background: #f5f3f7; position: absolute; padding: 15px;
      right: 15%; top: 80%; box-shadow: 4px 2px 4px 0 rgba(0,0,0,.12), 2px 2px 2px 0 rgba(0,0,0,.24);">
      <% Noti.where(user_id: current_user.id).each do |noti| %>
        <div style="padding: 5px 15px; border-bottom: 1px solid gray;">
          <span style="color: #113d85; font-weight: bold"><%= noti.review_title %></span> <%= t "nav.noti_message" %>
          <i class="fa fa-check-square-o" aria-hidden="true"
            title="<% if noti.state == "read" %><%= t "nav.noti_read" %><% else %><%= t "nav.noti_unread" %><% end %>"
            style="font-size: 1.5em; margin: 0 -10px 0 20px;
            <% if noti.state == "read" %>color: green;<% else %>color: gray;<% end %>"></i>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
    <% if current_user %>
      $('.nav-noti-btn').on('click', function() {
        $('.noti-field').toggleClass('hide');
        var url = '/notis/' + <%= current_user.id %>
        $.ajax({
          beforeSend: function(xhr){
            xhr.setRequestHeader('X-CSRF-Token',
              $('meta[name="csrf-token"]').attr('content'));
          },
          type:'PUT',
          url: url,
        })
      });
    <% end %>
    $('.dropdown-toggle').on('mouseenter', function() {
      var a = $(this).next();
      $('.dropdown-menu').css('display','none');
      a.css('display', 'block');
      $(a).on('mouseleave', function() {
        $(a).css('display', 'none');
      })
    })
  })
</script>
