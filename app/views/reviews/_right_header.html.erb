<div class="col-sm-7">
  <div id="btn-report" style="position: absolute; right: 3%; top: 5%; color: #a01e1e;">
    <% unless current_user && Report.where('user_id = ? AND review_id = ?',
      current_user.id, @cur_review.id).present? %>
      <i class="fa fa-flag" aria-hidden="true" style="font-size: 1.8em"></i>
    <% end %>
  </div>
  
  <div class="report-modal hide" style="position: absolute; right: 2%; top: 20%;
    padding: 5px 10px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);">
    <p style="font-size: 1.2em; text-transform: uppercase;"><%= t "review.report_this_review" %></p>
    <div class="row">
      <div class="col-sm-9">
        <textarea name="" id="review-reason" cols="30" rows="2"></textarea>
      </div>
      <div class="col-sm-3" style="padding-left: 0px">
        <div class="text-center btn-confirm-report" style="padding: 10px 5px;
          color:white;background: #59a7ff; text-transform: uppercase;
          margin-top: 2px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);">
          <%= t "review.report_confirm" %>
        </div>
      </div>
    </div>
  </div>

  <div class="" style="font-size: 2em; font-weight: bold">
    <%= @cur_review.title %>
  </div>

  <div class="" style="font-size: 1.2em; font-weight: lighter; font-style: italic; color: darkblue">
    <%= link_to @cur_review.user.name, @cur_review.user %>
  </div>

  <div class="" style="font-size: 1.5em">
    <%= @cur_review.store %>
  </div>

  <% if @cur_review.aji_id != nil %>
    <div class="" style="font-size: 1.5em">
      <%= Aji.find_by_id(@cur_review.aji_id).label %>
    </div>
  <% end %>
  <div>
    <span style="color: green;">
      <%= @cur_review.price_from %>-<%= @cur_review.price_upto %> <%= @cur_review.currency %></span>
  </div>

  <div class="rating-field row" style="padding-top: 40px;">
    <div class="col-sm-2 main-rating">
            <span style="background: rgba(17,180,54,0.85); padding: 15px;
              border-radius: 50%;color: white; font-size: 1.5em;"><%= @cur_review.average_point %></span>
    </div>
    <div class="rating">
      <div class="col-sm-2">
        <span style="color:#23ad6c; font-size: 1.2em;"><%= @cur_review.quality %></span>
        <p><%= t "review.quality" %></p>
      </div>

      <div class="col-sm-2">
        <span style="color:#23ad6c; font-size: 1.2em;"><%= @cur_review.place %></span>
        <p><%= t "review.place" %></p>
      </div>

      <div class="col-sm-2">
        <span style="color:#23ad6c; font-size: 1.2em;"><%= @cur_review.service %></span>
        <p><%= t "review.service" %></p>
      </div>

      <div class="col-sm-2">
        <span style="color:#23ad6c; font-size: 1.2em;"><%= @cur_review.price %></span>
        <p><%= t "review.price" %></p>
      </div>

    </div>
    <div class="col-sm-2" style="margin-left: -20px;border-left: 1px solid rgba(174,174,174,0.8)">
      <span style="color:#ad7b36; font-size: 1.2em;"><%= @cur_review.comment.count %></span>
      <p><%= t "review.comment" %></p>
    </div>
  </div>

  <div class="review-nav row" style="position: absolute;width: 98%;top: 126.5%;
    background: rgba(227,253,237,0.5);box-shadow:0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24)">
    <div id="like_field">
      <% if current_user %>
        <% if current_user.like.where(review_id: @cur_review.id).present? %>
          <div class="col-sm-4 btn-review-nav btn-unlike" style="color: #00a100" id="un-try-it">
            <i class="fa fa-check-circle" aria-hidden="true" style="font-size: 1.8em"></i>
            <span style="margin-left: 5px; font-size: 1.2em">
              <%= t "review.i_will_try" %>
            </span>
            <div style="display: inline-block;position: absolute;right: 10%;
              font-size: 1.4em;color: green;font-weight: 900;">
              <%= Like.where(review_id: @cur_review.id).count %>
            </div>
          </div>
        <% else %>
          <div class="col-sm-4 btn-review-nav btn-like" style="color: orange" id="try-it">
            <i class="fa fa-question-circle" aria-hidden="true" style="font-size: 1.8em"></i>
            <span style="margin-left: 5px; font-size: 1.2em">
              <%= t "review.try_it" %>
            </span>
            <div style="display: inline-block;position: absolute;right: 10%;
              font-size: 1.4em;color: green;font-weight: 900;">
              <%= Like.where(review_id: @cur_review.id).count %></div>
          </div>
        <% end %>
      <% else %>
        <%= link_to new_user_session_path do %>
          <div class="col-sm-4 btn-review-nav btn-like" style="color: #75716f">
            <i class="fa fa-question-circle" aria-hidden="true" style="font-size: 1.8em"></i>
            <span style="margin-left: 5px; font-size: 1.2em">
              <%= t "review.try_it" %>
            </span>
            <div style="display: inline-block;position: absolute;right: 10%;
              font-size: 1.4em;color: green;font-weight: 900;">
              <%= Like.where(review_id: @cur_review.id).count %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

    <div class="col-sm-4 btn-review-nav active review-btn" style="color:#ffa541">
      <i class="fa fa-bookmark" aria-hidden="true" style="font-size: 1.8em"></i>
      <span style="margin-left: 5px; font-size: 1.2em;color:#e1922a"><%= t "review.review" %></span></div>
    <div class="col-sm-4 btn-review-nav comment-btn" style="color:#287d8b">
      <i class="fa fa-comments" aria-hidden="true" style="font-size: 1.8em"></i>
      <span style="margin-left: 5px; font-size: 1.2em;"><%= t "review.comment" %></span></div>
  </div>
</div>
<style>
  .fa-flag:hover {
    color: #520000;
  }

  .btn-confirm-report:hover {
    background: #1083ad !important;
  }
</style>
<script type="text/javascript" charset="utf-8">
  <% if current_user %>
    $('.btn-unlike').on('mouseenter', function() {
      $('.btn-unlike i').removeClass('fa-check-circle').addClass('fa-times-circle');
      $('.btn-unlike span').text('Not anymore!');
      $(this).css("color","#FF332F").css('cursor', 'pointer');

      $('.btn-unlike').on('mouseleave', function() {
        $('.btn-unlike i').removeClass('fa-times-circle').addClass('fa-check-circle');
        $('.btn-unlike span').text("<%= t "review.i_will_try" %>");
        $(this).css("color","#00A100");
      });
    });

    $('.btn-like').on('mouseenter', function() {
      $('.btn-like i').removeClass('fa-question-circle').addClass('fa-check-circle');
      $('.btn-like span').text("<%= t "review.i_will_try" %>");
      $(this).css("color","#00A100").css('cursor', 'pointer');

      $('.btn-like').on('mouseleave', function() {
        $('.btn-like i').removeClass('fa-check-circle').addClass('fa-question-circle');
        $('.btn-like span').text("<%= t "review.try_it" %>");
        $(this).css("color","#FFA500");
      });
    });

    $('#btn-report').on('click', function() {
      $('.report-modal').removeClass('hide');
      $('.btn-confirm-report').on('click', function() {
        $.ajax({
          beforeSend: function (xhr) {
            xhr.setRequestHeader('X-CSRF-Token',
              $('meta[name="csrf-token"]').attr('content'));
          },
          type: 'POST',
          url: '/reports',
          data: {
            report: {
              user_id: <%= current_user.id %>,
              review_id: <%= @cur_review.id %>,
              reason: $('#review-reason').val(),
            }
          }
        }).success(function (d) {
          $('.btn-confirm-report').text("<%= t "review.report_complete" %>")
            .css('background','#00A100')
          setTimeout(function() {
            $('.report-modal').addClass('hide');
          }, 1000);

        });
      })
    });
  <% end %>
</script>
